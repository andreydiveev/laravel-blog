<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
use View;
use App\Services\ArticleService;
use App\Services\CategoryService;
use App\Services\TagService;

class ArticleController extends Controller
{
    /** @var ArticleService */
    protected $articleService;

    /** @var CategoryService */
    protected $categoryService;

    /** @var TagService  */
    protected $tagService;

    public function __construct(ArticleService $articleService, CategoryService $categoryService, TagService $tagService)
    {
        $this->articleService  = $articleService;
        $this->categoryService = $categoryService;
        $this->tagService      = $tagService;

        View::share('categories', $categoryService->getAll());
        View::share('tags', $tagService->getAll());
    }

    /**
     * Article list
     *
     * @return \Illuminate\Contracts\View\Factory|\Illuminate\View\View
     */
    public function index()
    {
        $articles = $this->articleService->paginate(5);

        return view('article.index', compact('articles'));
    }

    /**
     * Article by title slug
     *
     * @param string $slug
     *
     * @return \Illuminate\Contracts\View\Factory|\Illuminate\View\View
     */
    public function show(string $slug)
    {
        $article = $this->articleService->getBySlug($slug);

        return view('article.show', compact('article'));
    }

    /**
     * Article list by category slug
     *
     * @param string $slug
     *
     * @return \Illuminate\Contracts\View\Factory|\Illuminate\View\View
     */
    public function category(string $slug)
    {
        $category = $this->categoryService->getBySlug($slug);

        return view('article.category', [
            'articles' => $category->articles,
            'category' => $category
        ]);
    }

    /**
     * Article list by tag name
     *
     * @param string $name - tag name
     *
     * @return \Illuminate\Contracts\View\Factory|\Illuminate\View\View
     */
    public function tag(string $name)
    {
        $tag = $this->tagService->getByName($name);

        return view('article.tag', [
            'articles' => $tag->articles,
            'tag'      => $tag
        ]);
    }

    /**
     * Search categories
     *
     * @param Request $request
     *
     * @return \Illuminate\Contracts\View\Factory|\Illuminate\View\View
     */
    public function search(Request $request)
    {
        $title    = $request->get('q');
        $articles = $this->articleService->searchByTitle($title);

        return view('article.search', [
            'articles' =>  $articles,
            'q'        =>  $title
        ]);
    }

}
